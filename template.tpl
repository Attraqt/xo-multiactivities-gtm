___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "XO Multi-Activity Tracking",
  "categories": [
    "ANALYTICS",
    "ATTRIBUTION",
    "CONVERSIONS",
    "DATA_WAREHOUSING",
    "EXPERIMENTATION",
    "PERSONALIZATION"
  ],
  "brand": {
    "id": "crownpeak",
    "displayName": "Crownpeak",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Collect and unify several user activities in real-time from every touchpoint of the Customer Journey.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "mandatory",
    "displayName": "Required parameters",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "TEXT",
        "name": "trackerKey",
        "displayName": "Tracker key",
        "simpleValueType": true,
        "valueHint": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "This identifier is available on the platform once your account is created.",
        "canBeEmptyString": false
      },
      {
        "type": "TEXT",
        "name": "region",
        "displayName": "Region (optional)",
        "simpleValueType": true,
        "help": "The region in which your data is stored: currently only eu is available.",
        "defaultValue": "eu"
      },
      {
        "type": "TEXT",
        "name": "verb",
        "displayName": "Action",
        "simpleValueType": true,
        "defaultValue": "purchase",
        "help": "The action performed by the user that triggered the event."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "user",
    "displayName": "User information",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "PARAM_TABLE",
        "name": "identities",
        "displayName": "Identities",
        "paramTableColumns": [
          {
            "param": {
              "type": "TEXT",
              "name": "identity",
              "displayName": "Identity repository",
              "simpleValueType": true,
              "valueValidators": [
                {
                  "type": "NON_EMPTY"
                },
                {
                  "type": "REGEX",
                  "args": [
                    "^[a-z0-9]*$"
                  ],
                  "errorMessage": "Identity repositories must contain only lower case alphanumeric characters."
                }
              ],
              "help": "The identity repository defined by a slug. e.g. userid"
            },
            "isUnique": true
          },
          {
            "param": {
              "type": "SELECT",
              "name": "identityVal",
              "displayName": "Identity",
              "macrosInSelect": true,
              "selectItems": [],
              "simpleValueType": true,
              "help": "The user id from the repository. e.g. 123456"
            },
            "isUnique": false
          }
        ],
        "help": "User ids in each identity repository (sessionId, crmId, ecommerceId, email...).",
        "newRowTitle": "New identity",
        "newRowButtonText": "Add identity"
      },
      {
        "type": "GROUP",
        "name": "user segments",
        "displayName": "User segments",
        "groupStyle": "NO_ZIPPY",
        "subParams": [
          {
            "type": "SELECT",
            "name": "userSegments",
            "displayName": "Segments",
            "macrosInSelect": true,
            "selectItems": [],
            "simpleValueType": true,
            "notSetText": "Not set"
          },
          {
            "type": "TEXT",
            "name": "userSegmentsSeparator",
            "displayName": "Segment separator",
            "simpleValueType": true,
            "defaultValue": ",",
            "help": "The character used to separate values"
          }
        ],
        "help": "List of user segments. e.g. gender, status, user type"
      },
      {
        "type": "PARAM_TABLE",
        "name": "traits",
        "displayName": "Traits",
        "paramTableColumns": [
          {
            "param": {
              "type": "TEXT",
              "name": "trait",
              "displayName": "Name",
              "simpleValueType": true,
              "help": "Name of the trait. e.g. age"
            },
            "isUnique": true
          },
          {
            "param": {
              "type": "SELECT",
              "name": "traitVal",
              "displayName": "Value",
              "macrosInSelect": true,
              "selectItems": [],
              "simpleValueType": true,
              "help": "Value of the trait. e.g. 32"
            },
            "isUnique": false
          }
        ],
        "help": "Free object for user informations. (ex : Age \u003d 32)",
        "newRowTitle": "New trait",
        "newRowButtonText": "Add trait"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "activity",
    "displayName": "Activities information",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "GROUP",
        "name": "specific",
        "displayName": "Targets",
        "groupStyle": "NO_ZIPPY",
        "subParams": [
          {
            "type": "SELECT",
            "name": "targets",
            "displayName": "Target list",
            "macrosInSelect": true,
            "selectItems": [],
            "simpleValueType": true,
            "help": "A list of targets, each target is represented by an object.",
            "notSetText": "Add your product object list here"
          },
          {
            "type": "SIMPLE_TABLE",
            "name": "attributes",
            "displayName": "Attributes",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Key in XO Activity Object",
                "name": "name",
                "type": "TEXT"
              },
              {
                "defaultValue": "",
                "displayName": "Key in input object",
                "name": "key",
                "type": "TEXT"
              },
              {
                "defaultValue": "metadata",
                "displayName": "Type of attribute in XO Activity Object",
                "name": "type",
                "type": "SELECT",
                "selectItems": [
                  {
                    "value": "metadata",
                    "displayValue": "Metadata"
                  },
                  {
                    "value": "target",
                    "displayValue": "Target"
                  }
                ]
              }
            ],
            "help": "How to map the attributes from your objects to XO Activity Objects"
          }
        ],
        "help": "Targets can be products or categories for example."
      },
      {
        "type": "GROUP",
        "name": "global",
        "displayName": "Common",
        "groupStyle": "NO_ZIPPY",
        "subParams": [
          {
            "type": "SELECT",
            "name": "sourceId",
            "displayName": "Source id",
            "macrosInSelect": true,
            "selectItems": [],
            "simpleValueType": true,
            "help": "The source that generated the tracked object.",
            "notSetText": "Not set"
          },
          {
            "type": "GROUP",
            "name": "activity segments",
            "displayName": "",
            "groupStyle": "NO_ZIPPY",
            "subParams": [
              {
                "type": "SELECT",
                "name": "activitySegments",
                "displayName": "Segments",
                "macrosInSelect": true,
                "selectItems": [],
                "simpleValueType": true,
                "notSetText": "Not set"
              },
              {
                "type": "TEXT",
                "name": "activitySegmentsSeparator",
                "displayName": "Segment separator",
                "simpleValueType": true,
                "defaultValue": ","
              }
            ]
          },
          {
            "type": "SIMPLE_TABLE",
            "name": "commonMetadata",
            "displayName": "Common metadata of XO Activity Objects",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Key",
                "name": "name",
                "type": "TEXT"
              },
              {
                "defaultValue": "",
                "displayName": "Value",
                "name": "value",
                "type": "TEXT"
              }
            ]
          }
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const createQueue = require("createQueue");
const injectScript = require("injectScript");
const copyFromWindow = require("copyFromWindow");
const callInWindow = require("callInWindow");
const Object = require("Object");
const getType = require("getType");

// functions
const notNullOrEmpty = (value) => {
  return value !== "" && value !== null && typeof value !== "undefined";
};

const objArrayFactory = (array, keyKey, valueKey) => {
  const newobj = {};
  if (array && array.length > 0) {
    array.forEach((t) => {
      const key = t[keyKey];
      const val = t[valueKey];
      if (notNullOrEmpty(key) && notNullOrEmpty(val)) {
        newobj[key] = val;
      }
    });
  }
  return newobj;
};

const shallowMerge = (output, objectList) => {
  objectList.forEach((object) =>
    Object.entries(object).reduce((prev, current) => {
      prev[current[0]] = current[1];
      return prev;
    }, output)
  );
  return output;
};

const arrayOrSplit = (input, separator) => {
  if (getType(input) === "array") return input;
  return input ? input.split(separator) : [];
};
// set lib URL
const isIe = false;
const url = "https://cdn.attraqt.io/xo.activity-";
const version = "2.0.0";
const compat = isIe ? ".compat.min.js" : ".min.js";
const finalLibrary = url + version + compat;

// createQueue and set _attraqt
const pushQ = createQueue("_attraqt");

if (copyFromWindow("xo.activity.isInitialized") !== true) {
  const initOptions = { trackerKey: data.trackerKey };
  if (data.region && data.region !== "") {
    initOptions.region = data.region;
  }
  pushQ(["init", initOptions]);
}

// set user
if (data.identities && data.identities.length > 0) {
  data.identities.forEach((ident) => {
    const arr = ["addUserIdentity", ident.identity, ident.identityVal];
    if (notNullOrEmpty(ident.identity) && notNullOrEmpty(ident.identityVal)) {
      pushQ(arr);
    }
  });
}
pushQ([
  "setUserSegments",
  arrayOrSplit(data.userSegments, data.userSegmentsSeparator),
]);
pushQ(["setUserTraits", objArrayFactory(data.traits, "trait", "traitVal")]);

// set activity

const activities = [];
// convert input object into activities
data.targets.forEach((target) => {
  const productTargets = {};
  const productMetadata = {};
  (data.attributes || []).forEach((attribute) => {
    const key = attribute.name;
    const val = target[attribute.key];
    if (notNullOrEmpty(key) && notNullOrEmpty(val)) {
      if (attribute.type === "target") {
        productTargets[key] = val;
      } else if (attribute.type === "metadata") {
        productMetadata[key] = val;
      }
    }
  });
  const metadatas = shallowMerge({}, [
    objArrayFactory(data.commonMetadata, "name", "value"),
    productMetadata,
  ]);
  const activity = shallowMerge({}, [
    {
      action: data.verb,
      target: productTargets,
      metadata: metadatas,
      segments: arrayOrSplit(
        data.activitySegments,
        data.activitySegmentsSeparator
      ),
    },
    data.sourceId ? { sourceId: data.sourceId } : {},
  ]);
  activities.push(activity);
});
pushQ(["send", activities]);

if (copyFromWindow("xo.activity.isInitialized")) {
  callInWindow("xo.activity.handleQueuedEvents", "");
}

injectScript(finalLibrary, data.gtmOnSuccess, data.gtmOnFailure, "attraqtLib");


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_attraqt"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "xo.activity.isInitialized"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "xo.activity.handleQueuedEvents"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.attraqt.io/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Activities
  code: "const mockData = {\n  trackerKey: \"tracker-key\",\n  region: \"eu\",\n \
    \ verb: \"buy\",\n  targets: [\n    {\n      pid: \"id-1\",\n      qte: 2,\n \
    \     prix: 12300,\n    },\n    {\n      pid: \"id-2\",\n      qte: 10,\n    \
    \  prix: 199,\n    },\n  ],\n  attributes: [\n    {\n      name: \"product\",\n\
    \      key: \"pid\",\n      type: \"target\",\n    },\n    {\n      name: \"quantity\"\
    ,\n      key: \"qte\",\n      type: \"metadata\",\n    },\n    {\n      name:\
    \ \"price\",\n      key: \"prix\",\n      type: \"metadata\",\n    },\n  ],\n\
    \  commonMetadata: [\n    {\n      name: \"orderId\",\n      value: \"12345-6789\"\
    ,\n    },\n    {\n      name: \"currency\",\n      value: \"EUR\",\n    },\n \
    \   {\n      name: \"locale\",\n      value: \"en_GB\",\n    },\n  ],\n  activitySegments:\
    \ [\"seg-a\", \"seg-b\"],\n};\n\nconst activitiesToSend = [];\n\nmock(\"createQueue\"\
    , () => {\n  return (args) => {\n    const cmd = args[0];\n    if (cmd === \"\
    send\") {\n      activitiesToSend.push(args[1]);\n    }\n  };\n});\n\n// Call\
    \ runCode to run the template's code.\nrunCode(mockData);\n\n// Check only one\
    \ call to \nassertThat(activitiesToSend.length).isEqualTo(1);\nassertThat(activitiesToSend[0]).isEqualTo([\n\
    \  {\n    action: \"buy\",\n    target: { product: \"id-1\" },\n    metadata:\
    \ {\n      currency: \"EUR\",\n      locale: \"en_GB\",\n      quantity: 2,\n\
    \      price: 12300,\n      orderId: \"12345-6789\",\n    },\n    segments: [\"\
    seg-a\", \"seg-b\"],\n  },\n  {\n    action: \"buy\",\n    target: { product:\
    \ \"id-2\" },\n    metadata: {\n      currency: \"EUR\",\n      locale: \"en_GB\"\
    ,\n      quantity: 10,\n      price: 199,\n      orderId: \"12345-6789\",\n  \
    \  },\n    segments: [\"seg-a\", \"seg-b\"],\n  },\n]);\n"


___NOTES___

Created on 09/04/2020 à 14:36:43


